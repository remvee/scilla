<project name="Scilla Examples" default="all" basedir=".">

  <!-- application identifier -->
  <property name="app.name" value="scilla"/>
  <property name="scilla.project" value=".."/>

  <!-- scilla configuration -->
  <property name="source.dir" value="${basedir}/data/source"/>
  <property name="cache.dir"  value="${basedir}/data/cache"/>

  <!-- some defaults -->
  <property name="tomcat.home" value="/usr/local/tomcat"/>
  <property name="cvs2cl.exec" value="cvs2cl"/>
  <property name="build.compiler" value="jikes"/>

  <!-- our own servlet -->
  <property name="src.dir"    value="src"/>

  <!-- deployment hierarchy -->
  <property name="deploy.dir" value="${tomcat.home}/webapps/${app.name}"/>
  <property name="webinf.dir" value="${deploy.dir}/WEB-INF"/>
  <property name="build.dir"  value="${webinf.dir}/classes"/>
  <property name="lib.dir"    value="${webinf.dir}/lib"/>
  <property name="apidoc.dir" value="${deploy.dir}/doc"/>


<!-- targets -->


  <target name="all" depends="prepare,scilla,compile,apidoc">
    <echo>FIN</echo>
  </target>


  <target name="clean">
    <delete dir="${deploy.dir}"/>
    <delete dir="${cache.dir}"/>
  </target>


  <target name="prepare">

    <!-- copy web-app descriptor -->
    <mkdir dir="${webinf.dir}"/>
    <copy file="etc/web.xml" tofile="${webinf.dir}/web.xml"/>
    <replace file="${webinf.dir}/web.xml"
	    token="@source.dir@" value="${source.dir}"/>
    <replace file="${webinf.dir}/web.xml"
	    token="@cache.dir@" value="${cache.dir}"/>

    <!-- copy all JSP and HTML files -->
    <mkdir  dir="${deploy.dir}"/>
    <copy todir="${deploy.dir}">
      <fileset dir="web" excludes="**/*.swp"/>
    </copy>

    <!-- copy the libraries we depend on -->
    <mkdir  dir="${lib.dir}"/>
    <copy todir="${lib.dir}">
      <fileset dir="lib"/>
    </copy>

    <!-- create classes dir for helper classes -->
    <mkdir dir="${build.dir}"/>

    <!-- create scilla cache directory -->
    <mkdir dir="${cache.dir}"/>

    <available property="apidoc.done" file="${apidoc.dir}"/>
  </target>


  <target name="compile" depends="prepare">
    <javac srcdir="${src.dir}" destdir="${build.dir}"/>
    <copy todir="${build.dir}">
      <fileset dir="${src.dir}">
	<include name="**/*.properties"/>
      </fileset>
    </copy>
  </target>


  <target name="apidoc" depends="prepare" unless="apidoc.done">
    <ant dir="${scilla.project}" target="apidoc">
	<property name="apidoc.dir" value="${apidoc.dir}"/>
    </ant>
  </target>


  <target name="scilla" depends="prepare">
    <ant dir="${scilla.project}" target="compile"/>
  </target>

  <target name="changelog">
    <exec executable="${cvs2cl.exec}">
      <arg value="-P"/>
    </exec>
  </target>

</project>
