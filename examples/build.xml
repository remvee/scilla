<project name="Scilla Examples" default="all" basedir=".">

  <!-- application identifier -->
  <property name="app.name" value="scilla"/>

  <!-- some defaults -->
  <property name="tomcat.home" value="/usr/local/tomcat"/>
  <property name="cvs2cl.exec" value="cvs2cl"/>
  <property name="build.compiler" value="jikes"/>

  <!-- our own servlet -->
  <property name="src.dir"    value="src"/>

  <!-- scilla configuration (defaults) -->
  <property name="lame.exec"    value="/usr/local/bin/lame"/>
  <property name="imagick.exec" value="/usr/local/bin/convert"/>
  <property name="cache.dir"    value="${basedir}/data/cache"/>
  <property name="source.dir"   value="${basedir}/data/source"/>

  <property name="scilla.project" value=".."/>

  <!-- deployment hierarchy -->
  <property name="deploy.dir" value="${tomcat.home}/webapps/${app.name}"/>
  <property name="webinf.dir" value="${deploy.dir}/WEB-INF"/>
  <property name="build.dir"  value="${webinf.dir}/classes"/>
  <property name="lib.dir"    value="${webinf.dir}/lib"/>



<!-- targets -->


  <target name="all" depends="prepare,scilla,compile">
    <echo>FIN</echo>
  </target>


  <target name="clean">
    <delete dir="${deploy.dir}"/>
    <delete dir="${cache.dir}"/>
  </target>


  <target name="prepare">

    <!-- copy web-app descriptor -->
    <mkdir dir="${webinf.dir}"/>
    <copy file="etc/web.xml" todir="${webinf.dir}"/>

    <!-- copy all JSP and HTML files -->
    <mkdir  dir="${deploy.dir}"/>
    <copy todir="${deploy.dir}">
      <fileset dir="web" excludes="**/*.swp"/>
    </copy>

    <!-- copy the libraries we depend on -->
    <mkdir  dir="${lib.dir}"/>
    <copy todir="${lib.dir}">
      <fileset dir="lib"/>
    </copy>

    <!-- create classes dir for helper classes -->
    <mkdir dir="${build.dir}"/>

    <!-- create cache dir for scilla -->
    <mkdir dir="${cache.dir}"/>

  </target>


  <target name="compile" depends="prepare">
    <javac srcdir="${src.dir}" destdir="${build.dir}"/>
    <copy todir="${build.dir}">
      <fileset dir="${src.dir}">
	<include name="**/*.properties"/>
      </fileset>
    </copy>
  </target>


  <target name="scilla" depends="prepare">
    <ant dir="${scilla.project}" target="compile"/>
    <ant dir="${scilla.project}" target="config">
	<property name="source.dir" value="${source.dir}"/>
	<property name="cache.dir" value="${cache.dir}"/>
	<property name="imagick.exec" value="${imagick.exec}"/>
	<property name="lame.exec" value="${lame.exec}"/>
    </ant>
  </target>

  <target name="changelog">
    <exec executable="${cvs2cl.exec}">
      <arg value="-P"/>
    </exec>
  </target>

</project>
